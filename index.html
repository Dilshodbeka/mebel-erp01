<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мебельный Цех ERP</title>
    <!-- Подключаем библиотеку сканера -->
    <script src="unpkg.com"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        #reader { width: 100%; max-width: 500px; margin: auto; background: white; }
        .btn-group { margin-top: 20px; display: none; } /* Скрыто, пока не отсканирован код */
        button { padding: 15px 25px; font-size: 18px; cursor: pointer; border-radius: 8px; border: none; margin: 5px; }
        .start-btn { background: #28a745; color: white; }
        .stop-btn { background: #dc3545; color: white; }
        #result { margin-top: 20px; font-weight: bold; color: #333; }
    </style>
</head>
<body>

    <h1>Производство: Скан QR</h1>
    
    <!-- Сетка сканера -->
    <div id="reader"></div>
    
    <div id="result">Ожидание сканирования...</div>

    <!-- Кнопки управления (появляются после скана) -->
    <div id="controls" class="btn-group">
        <h3 id="order-id-display">Заказ №: ---</h3>
        <button class="start-btn" onclick="updateStatus('В РАБОТЕ')">Начать этап</button>
        <button class="stop-btn" onclick="updateStatus('ЗАВЕРШЕНО')">Завершить</button>
    </div>

    <script>
        function onScanSuccess(decodedText, decodedResult) {
            // Когда код успешно отсканирован:
            document.getElementById('result').innerText = "QR считан успешно!";
            document.getElementById('order-id-display').innerText = "Заказ: " + decodedText;
            document.getElementById('controls').style.display = "block"; // Показываем кнопки
            
            // Можно остановить сканер после успешного считывания
            html5QrcodeScanner.clear();
        }

        function updateStatus(status) {
            const orderId = document.getElementById('order-id-display').innerText;
            alert("Статус заказа " + orderId + " изменен на: " + status);
            // Здесь в будущем будет запрос к Supabase
        }

        // Настройка сканера
        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
    </script>
</body>
</html>
